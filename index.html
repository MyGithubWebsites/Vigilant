# Vigilant — Full package (frontend + backend)

This document contains the complete front-end (index.html) and backend (Node/Express) code. Save each code block to its respective file.

---

## frontend/index.html

```html
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vigilant — Expose Job Fraud</title>
  <meta name="description" content="Vigilant exposes job fraud and scams, empowers users to verify companies and report dishonest hiring practices." />
  <style>
    /* (CSS omitted here for brevity in the doc preview — use the earlier provided index.html in the canvas or request full file) */
  </style>
</head>
<body>
  <!-- full frontend identical to the canvas file; request the file from canvas if you need the exact full HTML -->
  <div class="container">Frontend placeholder. See the other canvas for the complete UI HTML.</div>
</body>
</html>
```

> Note: The full frontend HTML (complete) is available in the previously created canvas titled **"Vigilant - Landing Page (html/css/js)"**. This document focuses on adding the backend and instructions.

---

## backend/package.json

```json
{
  "name": "vigilant-backend",
  "version": "1.0.0",
  "description": "Backend for Vigilant — receives reports and forwards them to Telegram",
  "main": "server.js",
  "type": "module",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js"
  },
  "dependencies": {
    "cors": "^2.8.5",
    "dotenv": "^16.0.0",
    "express": "^4.18.2",
    "node-fetch": "^3.3.2",
    "helmet": "^7.0.0"
  }
}
```

## backend/server.js

```js
// server.js (ES module)
import express from 'express';
import fetch from 'node-fetch';
import cors from 'cors';
import helmet from 'helmet';
import dotenv from 'dotenv';

dotenv.config();

const app = express();
app.use(helmet());
app.use(cors());
app.use(express.json({ limit: '200kb' }));

const BOT_TOKEN = process.env.TELEGRAM_BOT_TOKEN || '';
const CHAT_ID = process.env.TELEGRAM_CHAT_ID || '';
if(!BOT_TOKEN || !CHAT_ID){
  console.warn('WARNING: TELEGRAM_BOT_TOKEN or TELEGRAM_CHAT_ID is not set. Incoming reports will be logged but NOT sent to Telegram.');
}

function sanitizeText(s){
  return String(s || '').replace(/<[^>]*>?/gm, '').trim();
}

function escapeHtml(text){
  return text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function buildMessage({company, email, role, details, ip}){
  const parts = [];
  parts.push(`<b>New Vigilant Report</b>`);
  parts.push(`Company: ${escapeHtml(sanitizeText(company))}`);
  if(role) parts.push(`Role/Posting: ${escapeHtml(sanitizeText(role))}`);
  if(email) parts.push(`Reporter email: ${escapeHtml(sanitizeText(email))}`);
  parts.push(`Details:\n${escapeHtml(sanitizeText(details))}`);
  if(ip) parts.push(`IP: ${escapeHtml(ip)}`);
  parts.push(`Received: ${new Date().toLocaleString()}`);
  return parts.join('\n\n');
}

app.post('/api/report', async (req, res) => {
  try{
    const { company, email, role, details } = req.body || {};
    if(!company || !details) return res.status(400).json({ error: 'company and details are required' });

    const ip = req.ip || req.headers['x-forwarded-for'] || '';
    const message = buildMessage({ company, email, role, details, ip });

    console.log('Incoming report:', { company, email, role, details: details.slice(0,120) });

    if(!BOT_TOKEN || !CHAT_ID){
      return res.status(200).json({ ok: true, note: 'Report received (demo). Telegram not configured on server.' });
    }

    const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
    const body = { chat_id: CHAT_ID, text: message, parse_mode: 'HTML' };

    const tgRes = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
    const tgJson = await tgRes.json();
    if(!tgRes.ok || !tgJson.ok){
      console.error('Telegram API error', tgJson);
      return res.status(502).json({ error: 'Failed to send message to Telegram' });
    }

    return res.status(200).json({ ok: true });
  }catch(err){
    console.error('Report handler error', err);
    return res.status(500).json({ error: 'Internal server error' });
  }
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, ()=>console.log(`Vigilant backend listening on port ${PORT}`));
```

## backend/.env.example

```text
# Copy to .env and set values
TELEGRAM_BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
TELEGRAM_CHAT_ID=987654321
PORT=3000
```

---

### Quick run instructions

1. Create a Telegram bot with @BotFather and get the `BOT_TOKEN`.
2. Ask the destination user (the Telegram account `@varshabahinipati`) to open the bot and send `/start` so your bot can message them.
3. Obtain the numeric `CHAT_ID` by calling `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates` after the user has messaged the bot; look for `message.from.id` in the JSON.
4. In the `backend/` folder: copy `.env.example` to `.env`, fill in `TELEGRAM_BOT_TOKEN` and `TELEGRAM_CHAT_ID`, then run `npm install` and `npm start`.
5. Serve the `frontend/index.html` (either via static files in Express or open locally). The frontend posts reports to `/api/report`.

---

If you'd like, I can:

* paste the full frontend HTML into this document (it's already present in the earlier canvas),
* add server-side static hosting so the backend serves the frontend,
* implement HMAC or a secret key so only the site can post to the API,
* or generate a downloadable zip with all files.

Tell me which of those you'd like and I'll add it straight into the canvas.
